import { useEffect } from "react";
import { useDispatch } from "react-redux";
import { notifyProducts } from "../../modules/Products/actions";

import WebsocketConnection from "../../services/websockets";
import { WebSocketNotification } from "./types";

const WebSocketListener = () => {
  const dispatch = useDispatch();

  useEffect(() => {
    const instance = WebsocketConnection.getInstance();

    instance.socket.on(
      "productUpdated",
      ({ _id, delta }: WebSocketNotification) => {
        dispatch(notifyProducts({ _id, delta }));
      }
    );

    return () => {
      instance.socket.close();
    };
  }, [dispatch]);

  return null;
};

export default WebSocketListener;
