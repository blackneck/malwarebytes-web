import React, { useCallback, useMemo } from "react";
import { useDispatch, useSelector } from "react-redux";

import { getCart } from "../../Cart/selectors";
import { setCurrentProductId, updateProductRequest } from "../actions";
import ProductModal from "../components/ProductModal";
import { Product } from "../types";

const ProductModalContainer = ({
  currentProduct,
}: {
  currentProduct: Product;
}) => {
  const dispatch = useDispatch();

  const { [currentProduct._id]: _amountInCart } = useSelector(getCart);

  const closeModal = useCallback(() => {
    dispatch(setCurrentProductId());
  }, [dispatch]);

  const addToCart = useCallback(() => {
    dispatch(updateProductRequest({ id: currentProduct._id, delta: -1 }));
  }, [dispatch, currentProduct]);

  const removeFromCart = useCallback(() => {
    dispatch(updateProductRequest({ id: currentProduct._id, delta: 1 }));
  }, [dispatch, currentProduct]);

  const amountInCart = useMemo(() => (_amountInCart ? _amountInCart : 0), [
    _amountInCart,
  ]);

  return (
    <ProductModal
      currentProduct={currentProduct}
      closeModal={closeModal}
      addToCart={addToCart}
      removeFromCart={removeFromCart}
      amountInCart={amountInCart}
    />
  );
};

export default ProductModalContainer;
